train_input_path: "data/test/movielens_1m/ml_train_data"
eval_input_path: "data/test/movielens_1m/ml_test_data"
model_dir: "experiments/cmbf_movielens_only_img_ckpt"

train_config {
  optimizer_config: {
    adam_optimizer: {
      learning_rate: {
        constant_learning_rate {
          learning_rate: 0.0001
        }
      }
      beta1: 0.9
      beta2: 0.999
    }
    use_moving_average: false
  }
  log_step_count_steps: 100
  save_checkpoints_steps: 100
  sync_replicas: true
  num_steps: 10
}

eval_config {
  metrics_set: {
<<<<<<< HEAD
=======
    gauc {
      uid_field: 'user_id'
    }
  }
  metrics_set: {
>>>>>>> f33889f93062b1a5774ecef5b8ab727b2dc5a541
    auc {}
  }
  metrics_set: {
    max_f1 {}
  }
}

data_config {
  input_fields {
<<<<<<< HEAD
    input_name:'rating'
    input_type: INT32
  }
  input_fields {
=======
>>>>>>> f33889f93062b1a5774ecef5b8ab727b2dc5a541
    input_name:'label'
    input_type: INT32
  }
  input_fields {
    input_name:'user_id'
    input_type: INT32
  }
  input_fields {
    input_name:'movie_id'
    input_type: INT32
  }
  input_fields {
    input_name:'gender'
    input_type: INT32
  }
  input_fields {
    input_name: 'age'
    input_type: INT32
  }
  input_fields {
    input_name: 'occupation'
    input_type: INT32
  }
  input_fields {
    input_name: 'zip_id'
    input_type: INT32
    default_val: '0'
  }
  input_fields {
    input_name: 'genres'
    input_type: STRING
    default_val: 'unknown'
  }
  input_fields {
    input_name: 'title'
    input_type: STRING
    default_val: 'unknown'
  }
  input_fields {
    input_name: 'movie_year_bin'
    input_type: INT32
  }
  input_fields {
    input_name: 'score_year_diff'
    input_type: INT32
    default_val: '0'
  }
  input_fields {
    input_name: 'score_time'
    input_type: DOUBLE
  }
  input_fields {
    input_name: 'embedding'
    input_type: STRING
    default_val: ''
  }

  label_fields: 'label'
  batch_size: 128
  num_epochs: 10000
  prefetch_size: 1
  input_type: CSVInput
}

feature_config: {
  features: {
    input_names: 'embedding'
    feature_type: RawFeature
    separator: '|'
    raw_input_dim: 512
  }
}
model_config: {
  model_class: 'CMBF'
  feature_groups: {
    group_name: 'image'
    feature_names: 'embedding'
    wide_deep: DEEP
  }
  cmbf {
    config {
      multi_head_num: 2
      image_multi_head_num: 2
      image_head_size: 8
      text_head_size: 8
      image_feature_dim: 64
      image_self_attention_layer_num: 2
      text_self_attention_layer_num: 2
      cross_modal_layer_num: 3
      image_cross_head_size: 8
      text_cross_head_size: 16
      max_position_embeddings: 16
      use_token_type: true
    }
    final_dnn: {
        hidden_units: 256
        hidden_units: 64
    }
  }
  embedding_regularization: 1e-6
}
export_config {
  exporter_type: "best"
  best_exporter_metric: "gauc"
  exports_to_keep: 1
}
